<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¯­éŸ³è¯†åˆ«æµ‹è¯•</title>
<style>
  body { font-family: sans-serif; max-width: 600px; margin: 40px auto; padding: 0 20px; }
  #output { min-height: 100px; border: 1px solid #ccc; padding: 12px; border-radius: 8px; margin: 16px 0; font-size: 16px; white-space: pre-wrap; }
  #interim { color: #999; }
  button { padding: 12px 24px; font-size: 16px; border-radius: 8px; border: none; cursor: pointer; margin-right: 8px; }
  #startBtn { background: #4CAF50; color: white; }
  #stopBtn { background: #f44336; color: white; }
  #status { color: #666; font-size: 14px; margin-top: 8px; }
</style>
</head>
<body>
<h2>Web Speech API æµ‹è¯•</h2>
<div style="background:#fff3cd;border:1px solid #ffc107;border-radius:8px;padding:10px 14px;margin-bottom:12px;font-size:14px;color:#856404;">
  âš ï¸ éœ€é€šè¿‡ HTTP æœåŠ¡å™¨è®¿é—®ï¼Œç›´æ¥æ‰“å¼€æ–‡ä»¶ä¼šæŠ¥ <code>not-allowed</code> é”™è¯¯ã€‚<br>
  è¿è¡Œï¼š<code>python3 -m http.server 8080</code>ï¼Œç„¶åè®¿é—® <code>http://localhost:8080</code>
</div>
<button id="startBtn">å¼€å§‹å½•éŸ³</button>
<button id="stopBtn" disabled>åœæ­¢</button>
<div id="status">å°±ç»ª</div>
<div id="output"><span id="final"></span><span id="interim"></span></div>
<button onclick="document.getElementById('final').textContent='';document.getElementById('interim').textContent=''">æ¸…ç©º</button>

<script>
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) {
  document.getElementById('status').textContent = 'âŒ æµè§ˆå™¨ä¸æ”¯æŒ Web Speech API';
} else {
  const rec = new SpeechRecognition();
  rec.lang = 'zh-CN';
  rec.continuous = true;
  rec.interimResults = true;

  rec.onstart = () => {
    document.getElementById('status').textContent = 'ğŸ™ï¸ å½•éŸ³ä¸­...';
    document.getElementById('startBtn').disabled = true;
    document.getElementById('stopBtn').disabled = false;
  };
  rec.onend = () => {
    document.getElementById('status').textContent = 'â¹ï¸ å·²åœæ­¢';
    document.getElementById('startBtn').disabled = false;
    document.getElementById('stopBtn').disabled = true;
  };
  rec.onerror = e => {
    document.getElementById('status').textContent = 'âŒ é”™è¯¯: ' + e.error;
    document.getElementById('startBtn').disabled = false;
    document.getElementById('stopBtn').disabled = true;
  };
  rec.onresult = e => {
    let final = '', interim = '';
    for (let i = e.resultIndex; i < e.results.length; i++) {
      e.results[i].isFinal ? final += e.results[i][0].transcript : interim += e.results[i][0].transcript;
    }
    if (final) document.getElementById('final').textContent += final;
    document.getElementById('interim').textContent = interim;
  };

  document.getElementById('startBtn').onclick = () => rec.start();
  document.getElementById('stopBtn').onclick = () => rec.stop();
}
</script>
</body>
</html>
